<!DOCTYPE html>
<html lang="en">

<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8"/>
    <title>画廊管理</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="" name="description"/>
    <meta content="" name="author"/>
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="media/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/style-metro.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/style.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/style-responsive.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/default.css" rel="stylesheet" type="text/css" id="style_color"/>
    <link href="media/css/uniform.default.css" rel="stylesheet" type="text/css"/>
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN PAGE LEVEL STYLES -->
    <link rel="stylesheet" type="text/css" href="media/css/select2_metro.css"/>
    <link rel="stylesheet" href="media/css/DT_bootstrap.css"/>
    <!-- END PAGE LEVEL STYLES -->
    <link rel="shortcut icon" href="media/image/favicon.ico"/>
    <link rel="stylesheet" href="media/css/fileinput.min.css"/>
    <script src="../front/js/subSystemConfig/config_shaoxing.js" type="text/javascript"></script>
</head>

<!-- END HEAD -->

<!-- BEGIN BODY -->

<body class="page-header-fixed">

<!-- BEGIN HEADER -->

<div class="header navbar navbar-inverse navbar-fixed-top">

    <!-- BEGIN TOP NAVIGATION BAR -->

    <div class="navbar-inner">

        <div class="container-fluid">

            <!-- BEGIN LOGO -->

            <a class="brand" href="index.html">

                <img src="media/image/logo_new.png" alt="logo"/>

            </a>

            <!-- END LOGO -->

            <!-- BEGIN RESPONSIVE MENU TOGGLER -->

            <a href="javascript:;" class="btn-navbar collapsed" data-toggle="collapse" data-target=".nav-collapse">

                <img src="media/image/menu-toggler.png" alt=""/>

            </a>

            <!-- END RESPONSIVE MENU TOGGLER -->

            <!-- BEGIN TOP NAVIGATION MENU -->

            <ul class="nav pull-right">
                <!-- BEGIN USER LOGIN DROPDOWN -->

                <li class="dropdown user">

                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">

                        <span id= "username" class="username"></span>

                        <i class="icon-angle-down"></i>

                    </a>

                    <ul class="dropdown-menu">

                        <li><a href="javascript:void(0);" onclick="logout()"><i class="icon-key"></i>退出登录</a></li>

                    </ul>

                </li>

                <!-- END USER LOGIN DROPDOWN -->

            </ul>

            <!-- END TOP NAVIGATION MENU -->

        </div>

    </div>

    <!-- END TOP NAVIGATION BAR -->

</div>

<!-- END HEADER -->

<!-- 左侧菜单栏 -->

<div class="page-container row-fluid">
    <div class="page-sidebar nav-collapse collapse">
        <ul class="page-sidebar-menu">
            <!-- 左侧隐藏按钮 -->
            <li>
                <div class="sidebar-toggler hidden-phone"></div>
            </li>
            <!-- 一级菜单 -->
            <li>
                <a href="javascript:void(0);">
                    <i class="icon-home"></i>
                    <span class="title">用户管理</span>
                    <span class="arrow "></span>
                </a>
                <ul class="sub-menu">
                    <li>
                        <a href="javascript:openChangePwd();">
                            <i class="icon-cogs"></i>
                            <span class="title">密码修改</span>
                            <span class="arrow "></span>
                        </a>
                    </li>
                    <li id="userlist_super">
                        <a href="javascript:openUserList();">
                            <i class="icon-cogs"></i>
                            <span class="title">用户列表</span>
                            <span class="arrow "></span>
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <!-- END SIDEBAR MENU -->

    </div>

    <!-- END SIDEBAR -->

    <!-- BEGIN PAGE -->

    <div id="content" class="page-content">

        <!-- BEGIN PAGE CONTAINER-->

        <div class="container-fluid">

            <!-- BEGIN PAGE HEADER-->

            <div class="row-fluid">

                <div class="span12">

                    <!-- BEGIN STYLE CUSTOMIZER -->

                    <div class="color-panel hidden-phone">

                        <div class="color-mode-icons icon-color"></div>

                        <div class="color-mode-icons icon-color-close"></div>
                        <!-- 设置 -->
                        <div class="color-mode">

                            <p>皮肤</p>

                            <ul class="inline">

                                <li class="color-black current color-default" data-style="default"></li>

                                <li class="color-blue" data-style="blue"></li>

                                <li class="color-brown" data-style="brown"></li>

                                <li class="color-purple" data-style="purple"></li>

                                <li class="color-grey" data-style="grey"></li>


                            </ul>

                        </div>

                    </div>

                    <!-- END BEGIN STYLE CUSTOMIZER -->


                    <h3 class="page-title">
                        <div id="backSysName"></div>
                        <small style="color: #79cd38"><a href="http://bode.kepuez.cn/" target="_blank">博得科普</a></small>
                    </h3>


                    <!-- END PAGE TITLE & BREADCRUMB-->

                </div>

            </div>

            <!-- END PAGE HEADER-->

            <!-- 列表 -->

            <div class="row-fluid">

                <div class="span12">

                    <!-- BEGIN EXAMPLE TABLE PORTLET-->

                    <div class="portlet box green">

                        <div class="portlet-title">

                            <div class="caption"><i class="icon-globe"></i>画廊管理

                            </div>

                            <div class="tools">
                                选择画廊地点：
                                <!-- 一级select -->
                                <select id="district" data-getDataUrl="/area/street">
                                    <option value=''>请选择地区</option>
                                </select>
                                <!-- 二级select -->
                                <select id="street" data-getDataUrl="/area/community" style="display:none;">
                                </select>
                                <!-- 三级select -->
                                <select id="community" data-getDataUrl="/gallery/list" style="display:none;">
                                </select>
                            </div>

                        </div>



                        <div class="portlet-body" id="galleryDiv">
                            <button class="btn purple" type="button" onclick="addGallery()">添加画廊</button>
                            <table id="galleryTable" class="table table-striped table-bordered table-hover table-full-width dataTable">
                                <thead class="thead">
                                    <tr>
                                        <th>画廊编号</th>
                                        <th>画廊名称</th>
                                        <th>建立时间</th>
                                        <th>责任人</th>
                                        <th>联系电话</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody class="tbody"></tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="footer">

    <div class="footer-inner">

        2018 &copy; 浙江博得科普文化发展有限公司.

    </div>

</div>
<!-- 这里是修改密码的弹出框 -->
<div class="out2">
    <div class="out_content">
        <div class="inner">
            <div class="inner_content">
                <div>
                    <form id="changPwd-form" action="/login.html">
                        <input type="hidden" class="input" name="username" id="usernamehide"/>
                        <label>原密码：</label>
                        <input type="text" class="input" name="oldpwd"/>
                        <label>新密码：</label>
                        <input type="text" class="input" name="newpwd"/>
                        <div>
                            <button class="btn green" type="button" onclick="changePwd()">提交</button>
                            <button class="btn red" type="button" onclick="closeChangePwd()">关闭</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 用户列表激活 -->
<div class="out3">
    <div class="out_content">
        <div class="inner">
            <div class="inner_content">
                <div>
                    <div class="portlet-body">
                        <table id="userlist" class="table table-striped table-bordered table-hover table-full-width dataTable">
                            <thead class="thead">
                                <tr>
                                    <th>账号</th>
                                    <th>姓名</th>
                                    <th>联系电话</th>
                                    <th>是否激活</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody class="tbody">
                            </tbody>
                        </table>
                    </div>
                    <div>
                        <button class="btn red" type="button" onclick="closeUserList()">关闭</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 画廊修改弹出框 -->
<div class="out">
    <div class="out_content">
        <div class="inner">
            <div class="inner_content">
                <div>
                    <form id="gallery-form">
                        <label>画廊编号：</label><input name="id" type="text" class="input" readonly/>
                        <label>画廊名称(必填)：</label><input name="name" type="text" class="input"/>
                        <label>维护状态：</label><input name="maintenancestatus" type="text" class="input"/>
                        <label>更换周期：</label><input name="changeperiod" type="text" class="input"/>
                        <label>负责人：</label><input name="personincharge" type="text" class="input"/>
                        <label>联系方式：</label><input name="telofpersonincharge" type="text" class="input"/>
                        <input id="communityId" name="community" type="hidden" class="input"/>
                        <input id="galleryCreatedBy" name="createdby" type="hidden" class="input"/>
                        <div>
                            <button class="btn green" type="button" onclick="saveGallery()">保存</button>
                            <button class="btn red" type="button" onclick="closeGallery()">关闭</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- 这里是某一个画廊的展板记录的弹出框 -->
<div class="out4">
    <div class="out_content">
        <div class="inner">
            <div class="inner_content">
                <!-- 关闭按钮 -->
                <span style="margin: 2em">
                    <button class="btn green" onclick="addPanelHistory()">添加展板更换记录</button>&nbsp;&nbsp;
                    <button class="btn red" onclick="closePanelHistory()">关闭</button>
                </span>

                <table class="details_table">
                    <tbody id="panelHistoryList">
                        <!-- 循环form表单 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- 这里是展板记录添加弹出框 -->
<div class="out1">
    <div class="out_content">
        <div class="inner">
            <div class="inner_content">
                <div>
                    <form id="panel-form">
                        <label>展板主题：</label><input name="changedescription" type="text" class="input"/>
                        <label>展板描述：</label><input id="fixPanelDesc" name="paneldescription" type="text" class="input" readonly/>
                        <label>展板图片：</label><input name="image" type="file" class="input"/>
                        <label>本次更换人：</label><input id="onetimeperson" name="modifiedby" type="text" class="input"/>
                        <label>本次更换时间：</label><input name="changedate" type="date" class="input"/>
                        <input id="galleryHiddenId" name="gallery" type="hidden"/>
                        <input id="uploadedbytran" name="uploadedbytran" type="hidden"/>
                        <div>
                            <button class="btn green" type="button" onclick="savePanelHistory()">保存</button>
                            <button class="btn red" type="button" onclick="closeAPanelHistory()">关闭</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="media/js/jquery-1.10.1.min.js" type="text/javascript"></script>

<script src="media/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>

<!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->

<script src="media/js/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>

<script src="media/js/bootstrap.min.js" type="text/javascript"></script>

<!--[if lt IE 9]>

<script src="media/js/excanvas.min.js"></script>

<script src="media/js/respond.min.js"></script>

<![endif]-->

<script src="media/js/jquery.slimscroll.min.js" type="text/javascript"></script>

<script src="media/js/jquery.blockui.min.js" type="text/javascript"></script>

<script src="media/js/jquery.cookie.min.js" type="text/javascript"></script>

<script src="media/js/jquery.uniform.min.js" type="text/javascript"></script>

<!-- END CORE PLUGINS -->

<!-- BEGIN PAGE LEVEL PLUGINS -->

<script type="text/javascript" src="media/js/select2.min.js"></script>

<script type="text/javascript" src="media/js/jquery.dataTables.min.js"></script>

<script type="text/javascript" src="media/js/DT_bootstrap.js"></script>

<!-- END PAGE LEVEL PLUGINS -->

<!-- BEGIN PAGE LEVEL SCRIPTS -->

<script src="media/js/app.js"></script>

<script src="media/js/table-advanced.js"></script>

<script src="media/js/fileinput.min.js"></script>

<script>

    //级联select:一级select的值发生改变，触发二级的选项改变
    $("#district").change(function(){
        //清空二级和三级select的旧选项
        $("#street").empty();
        $("#community").empty();
        //请求二级select选项数据地址
        var targetUrl = $(this).attr("data-getDataUrl");
        //获得一级select的值
        var firstValue = $(this).val();
        //如果一级select的值为null，隐藏二、三级select,并返回
        if(firstValue == ''){
            $("#street").fadeOut("slow");
            $("#community").fadeOut("slow");
            return;
        }

        //根据一级select的值，异步获取数据更新二级的选项
        $.ajax({
            type:'get',
            url:targetUrl,
            data:{
                district:firstValue
            },
            cache:false,
            dataType:'json',
            success:function(secondDatas){
                //遍历回传的数据添加到二级select
                var temp =  "<option value=''>请选择街道</option>";
                $("#street").append(temp);
                $.each(secondDatas, function(key, secondData) {
                    var option = '<option value="'+secondData.id+'">'+secondData.name+'</option>'
                    $("#street").append(option)
                });
                //二级select展示
                $("#street").fadeIn("slow");
                //三级select隐藏
                $("#community").fadeOut("slow");
            },
            error:function(){
                alert("请求失败")
            }
        });
    });

    //级联select:二级select值改变，触发三级select变化
    $("#street").change(function(){
        //清空三级slect的旧选项
        $("#community").empty();
        //请求二级select选项数据地址
        var targetUrl = $(this).attr("data-getDataUrl");
        //二级select的值
        var secondValue = $(this).val();
        //如果一级select的值为null，隐藏三级select,并返回
        if(secondValue == ''){
            $("#community").fadeOut("slow");
            return;
        }
        //根据二级select的值，异步获取数据更新三级的选项
        $.ajax({
            type:'get',
            url:targetUrl,
            data:{
                street:secondValue
            },
            cache:false,
            dataType:'json',
            success:function(thirdDatas){
                //遍历回传的数据添加到三级select
                var temp1 =  "<option value=''>请选择画廊所在地</option>";
                $("#community").append(temp1);
                $.each(thirdDatas, function(key, thirdData) {
                    var option = '<option value="'+thirdData.id+'">'+thirdData.name+'</option>'
                    $("#community").append(option);
                })
                //三级select显示出来
                $("#community").fadeIn("slow");
            },
            error:function(){
                alert("请求失败")
            }
        });
    });

    //级联select:三级select值改变，触发画廊表格更新
    $("#community").change(function(){
        //请求社区画廊列表数据地址
        var targetUrl = $(this).attr("data-getDataUrl");
        //三级select的值
        var thirdValue = $(this).val();
        //如果一级select的值为null，隐藏三级select,并返回
        if(thirdValue == ''){
            //将表格置为空
            $('#galleryTable').dataTable({
                "serverSide" : true, //是否启动服务器端数据导入
                "processing" : true, //DataTables载入数据时，是否显示‘进度’提示
                "searching" : false,//禁止搜索框
                "paging": false, // 禁止分页
                "info": false,   //去掉底部文字
                "destroy": true,
                "ajax": targetUrl+"?community="+thirdValue,
                columns : [
                    {data : "id"},
                    {data : "name"},
                    {data : "createdtime"},
                    {data : "personincharge"},
                    {data : "telofpersonincharge"}
                ],
                "columnDefs": [
                    {
                        "targets": [5],
                        "data": "id",
                        "render": function(data, type, full) {
                            return "<button onclick=openGallery("+data+") class='btn green'>画廊明细</button>&nbsp;&nbsp;<button onclick=showPanelHistory("+data+") class='btn blue'>展板更换记录</button>&nbsp;&nbsp;<button onclick=deleteGallery("+data+") class='btn red'>删除画廊</button>";
                        }
                    }
                ],
                "language": {
                    "zeroRecords": "你选择的这个单位还没有画廊！"
                },
            "data":[]
            });
            return;
        }
        //根据三级select的值，异步获取画廊数据
        $('#galleryTable').dataTable({
            "serverSide" : true, //是否启动服务器端数据导入
            "processing" : true, //DataTables载入数据时，是否显示‘进度’提示
            "searching" : false,//禁止搜索框
            "paging": false, // 禁止分页
            "info": false,   //去掉底部文字
            "destroy": true,
            "ajax": targetUrl+"?community="+thirdValue,
            columns : [
                {data : "id"},
                {data : "name"},
                {data : "createdtime"},
                {data : "personincharge"},
                {data : "telofpersonincharge"}
            ],
            "columnDefs": [
                {
                    "targets": [5],
                    "data": "id",
                    "render": function(data, type, full) {
                        return "<button onclick=openGallery("+data+") class='btn green'>画廊明细</button>&nbsp;&nbsp;<button onclick=showPanelHistory("+data+") class='btn blue'>展板更换记录</button>&nbsp;&nbsp;<button onclick=deleteGallery("+data+") class='btn red'>删除画廊</button>";
                    }
                }
            ],
            "language": {
                "zeroRecords": "你选择的这个单位还没有画廊！"
            }
        });
    });

    function getuserlist(){
        var url= "/user/findUserlist";
        //查询时先删除userlist
        var table=$('#userlist').dataTable();
        if(table){
            table.fnDestroy();
        }
        $('#userlist').dataTable({
            "serverSide" : true, //是否启动服务器端数据导入
            "processing" : true, //DataTables载入数据时，是否显示‘进度’提示
            "ajax": url,
            columns : [
                {data : "username"},
                {data : "name"},
                {data : "tel"},
                {data : "isactive"}
            ],
            "columnDefs": [
                {
                    "targets": [4],
                    "data": "username",
                    "render": function(data, type, full) {
                        return "<button onclick=activeUser('"+data+"',"+1+") class='btn green'>激活</button>&nbsp;&nbsp;&nbsp;&nbsp;<button onclick=activeUser('"+data+"',"+0+") class='btn red'>禁用</button>";
                    }
                }
            ],
            "lengthMenu": [5],
            "language": {
                "sProcessing": "努力加载数据中.",
                "sLengthMenu": "每页显示 _MENU_ 条记录",
                "sInfo": "从 _START_ 到 _END_ /共 _TOTAL_ 条数据",
                "sInfoEmpty": "没有数据",
                "sInfoFiltered": "(从 _MAX_ 条数据中检索)",
                "sSearch": "模糊查询:",
                "zeroRecords": "你选择的这个单位还没有画廊！",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "前一页",
                    "sNext": "后一页",
                    "sLast": "尾页"
                }
            },
            "searching" : false
        });
    }

    jQuery(document).ready(function () {
        App.init();
    });

    $(function(){
        $('#table span').toggle(function(){
            var index = $('#table .record').index(this);
            $('#table .details:eq('+index+')').addClass('tabActive');
            $(this).addClass("row-details-open").removeClass("row-details-close");
        },function(){
            var index = $('#table .record').index(this);
            $('#table .details:eq('+index+')').removeClass('tabActive');
            $(this).addClass("row-details-close").removeClass("row-details-open");
        })
        var navheight = $('.header').height();
        var footerheight = $('.footer').outerHeight();
        var minheight = $(window).height()-navheight-footerheight;
        $('#content').css('min-height',minheight);

        //以下是验证token
        var usertoken = $.cookie("usertoken");
        if(usertoken==null){
            window.location.href = "/login.html";
        }else {
            $.ajax({
                //几个参数需要注意一下
                type: "post",//方法类型
                dataType: "json",//预期服务器返回的数据类型
                url: "/user/validtoken" ,//url
                data: {"token":usertoken},
                success: function (data) {
                    if(data==null) {
                        window.location.href = "/login.html";
                    } else {
                        $("#backSysName").html(config_city+"科普画廊后台管理系统");
                        $("#username").html(data.username);
                        $("#usernamehide").val(data.username);
                        if(data.userrole!=1) {
                            $("#userlist_super").hide();
                        }
                        //load所有的区
                        $.ajax({
                            type:'get',
                            url:'/area/district',
                            cache:false,
                            async: false,
                            dataType:'json',
                            success:function(firstDatas){
                                //遍历回传的数据添加到一级select
                                $.each(firstDatas, function(key, firstData) {
                                    var option = '<option value="'+firstData.id+'">'+firstData.name+'</option>'
                                    $("#district").append(option);
                                })
                            },
                            error:function(){
                                alert("请求失败")
                            }
                        });
                    }
                },
                error : function() {
                    alert("异常！");
                }
            });
        }
        //验证结束
    });

    function changePwd() {
        $.ajax({
            //几个参数需要注意一下
            type: "post",//方法类型
            dataType: "json",//预期服务器返回的数据类型
            url: "/user/updatePwd" ,//url
            data: $('#changPwd-form').serialize(),
            success: function (data) {
                alert(data.resultDescription);
                if (data.result) {
                    $('#changPwd-form').submit();
                }
            },
            error : function() {
                alert("异常！");
            }
        });
    }

    function logout(){
        $.cookie('usertoken', null);
        window.location.href = "/background/login.html";
    }

    function addGallery(){
        var community = $('#community option:selected') .val();
        if (community==""||community==undefined) {
            alert("请先选择画廊地点");
        }else {
            $("#communityId").val(community);
            $("#galleryCreatedBy").val($("#usernamehide").val());
            var out = $('.out');
            out.fadeIn(500);
        }
    }

    function saveGallery() {
        $.ajax({
            //几个参数需要注意一下
            type: "post",//方法类型
            dataType: "json",//预期服务器返回的数据类型
            url: "/gallery/save" ,//url
            data: $('#gallery-form').serialize(),
            success: function (data) {
                alert(data.resultDescription);
            },
            error : function() {
                alert("异常！");
            }
        });
    }

    function closeGallery() {
        var out = $('.out');
        out.fadeOut(500);
        var communitId = $("#communityId").val();
        $('#galleryTable').dataTable({
            "serverSide" : true, //是否启动服务器端数据导入
            "processing" : true, //DataTables载入数据时，是否显示‘进度’提示
            "searching" : false,//禁止搜索框
            "paging": false, // 禁止分页
            "info": false,   //去掉底部文字
            "destroy": true,
            "ajax": "/gallery/list?community="+communitId,
            columns : [
                {data : "id"},
                {data : "name"},
                {data : "createdtime"},
                {data : "personincharge"},
                {data : "telofpersonincharge"}
            ],
            "columnDefs": [
                {
                    "targets": [5],
                    "data": "id",
                    "render": function(data, type, full) {
                        return "<button onclick=openGallery("+data+") class='btn green'>画廊明细</button>&nbsp;&nbsp;<button onclick=showPanelHistory("+data+") class='btn blue'>展板更换记录</button>&nbsp;&nbsp;<button onclick=deleteGallery("+data+") class='btn red'>删除画廊</button>";
                    }
                }
            ],
            "language": {
                "zeroRecords": "你选择的这个单位还没有画廊！"
            }
        });

        $('#gallery-form').find('[name]').each(function() {
            var type = $(this)[0].nodeName.toLowerCase();
            var name = $(this).attr('name');
            $(type+"[name='"+name+"']").val(null);
        });
    }

    function setGalleryInfo(data){
        //简便方法
        $('#gallery-form').find('[name]').each(function() {
            var type = $(this)[0].nodeName.toLowerCase();
            var name = $(this).attr('name');
            $(type+"[name='"+name+"']").val(data[''+name+'']);
        });
    }

    function openGallery(galleryId){
        var out = $('.out');
        out.fadeIn(500);
        var url = "/gallery/findAGallery";
        $.ajax({
            //几个参数需要注意一下
            type: "get",//方法类型
            dataType: "json",//预期服务器返回的数据类型
            url: url ,//url
            data: {"id":galleryId},
            success: function (data) {
                setGalleryInfo(data);
            },
            error : function() {
                alert("异常！");
            }
        });
    }

    function deleteGallery(id){
        var url = "/gallery/delete";
        if (confirm('确定要删除吗？')) {
            $.ajax({
                //几个参数需要注意一下
                type: "post",//方法类型
                dataType: "json",//预期服务器返回的数据类型
                url: url ,
                data: {"id":id},
                success: function (data) {
                    alert(data.resultDescription);
                    if (data.result) {
                        var community = $('#community option:selected') .val();
                        $('#galleryTable').dataTable({
                            "serverSide" : true, //是否启动服务器端数据导入
                            "processing" : true, //DataTables载入数据时，是否显示‘进度’提示
                            "searching" : false,//禁止搜索框
                            "paging": false, // 禁止分页
                            "info": false,   //去掉底部文字
                            "destroy": true,
                            "ajax": "/gallery/list?community="+community,
                            columns : [
                                {data : "id"},
                                {data : "name"},
                                {data : "createdtime"},
                                {data : "personincharge"},
                                {data : "telofpersonincharge"}
                            ],
                            "columnDefs": [
                                {
                                    "targets": [5],
                                    "data": "id",
                                    "render": function(data, type, full) {
                                        return "<button onclick=openGallery("+data+") class='btn green'>画廊明细</button>&nbsp;&nbsp;<button onclick=showPanelHistory("+data+") class='btn blue'>展板更换记录</button>&nbsp;&nbsp;<button onclick=deleteGallery("+data+") class='btn red'>删除画廊</button>";
                                    }
                                }
                            ],
                            "language": {
                                "zeroRecords": "你选择的这个单位还没有画廊！"
                            }
                        });
                    }
                },
                error : function() {
                    alert("异常！");
                }
            });
        }
    }






    function showPanelHistory(galleryId) {
        var out4 = $('.out4');
        out4.fadeIn(500);
        var url = "/panel/list";
        $.ajax({
            //几个参数需要注意一下
            type: "get",//方法类型
            dataType: "json",//预期服务器返回的数据类型
            url: url ,//url
            data: {"gallery":galleryId},
            success: function (panellist) {
                $.each(panellist,function(i,data){
                    //alert(data.paneldescription);
                    var tempForm = '<tr style="border-top: 2px solid">\n' +
                        '                                <td><form id="panelform-'+data.id+'"  class="history" action="">\n' +
                        '                                    <div style="width: 50%;float: left">\n' +
                        '                                            <input type="hidden" name="id1" value="'+data.id+'"/>\n' +
                        '                                        <div>\n' +
                        '                                            <label>展板主题:</label>\n' +
                        '                                            <input type="text" name="changedescription1" value="'+data.changedescription+'"/>\n' +
                        '                                        </div>\n' +
                        '                                        <div>\n' +
                        '                                            <label for="name">展板描述:</label>\n' +
                        '                                            <input type="text" name="paneldescription1" value="'+data.paneldescription+'"/>\n' +
                        '                                        </div>\n' +
                        '                                        <div>\n' +
                        '                                            <label for="name">本次更换人:</label>\n' +
                        '                                            <input type="text" name="modifiedby1" value="'+data.modifiedby+'"/>\n' +
                        '                                        </div>\n' +
                        '                                        <div>\n' +
                        '                                            <label for="name">本次更换时间:</label>\n' +
                        '                                            <input type="date" name="changedate1" value="'+data.changedate+'"/>\n' +
                        '                                        </div>\n' +
                        '                                        <div>\n' +
                        '                                            <button class="btn green" type="button" onclick="updatePanel('+data.id+')">保存</button>\n' +
                        '                                        </div>\n' +
                        '                                    </div>\n' +
                        '                                    <div style="width: 50%; float: left">\n' +
                        '                                        <div>\n' +
                        '                                            <label >画廊图片:</label>\n' +
                        '                                            <img style="width:100%" src="'+config_imageUrl+data.image+'" alt=""/>\n' +
                        '                                        </div>\n' +
                        '                                        <div>\n' +
                        '                                            <label>点击上传更换图片:</label>\n' +
                        '                                            <input type="file" name="image1">\n' +
                        '                                        </div>\n' +
                        '                                    </div>\n' +
                        '                                </form></td>\n' +
                        '                            </tr>';
                   $("#panelHistoryList").append(tempForm);
                });
            },
            error : function() {
                alert("异常！");
            }
        });

        //在单条历史表单中事先植入
        $("#galleryHiddenId").val(galleryId);
        $("#uploadedbytran").val($("#usernamehide").val());
    }

    function addPanelHistory() {
        $("#fixPanelDesc").val(config_displayPanel);
        var url = "/gallery/findAGallery";
        $.ajax({
            //几个参数需要注意一下
            type: "get",//方法类型
            dataType: "json",//预期服务器返回的数据类型
            url: url ,//url
            data: {"id":$("#galleryHiddenId").val()},
            success: function (data) {
                $("#onetimeperson").val(data.personincharge);
            },
            error : function() {
                alert("异常！");
            }
        });
        var out1 = $('.out1');
        out1.fadeIn(500);
    }

    function savePanelHistory() {
        var form = $('#panel-form')[0];
        var data = new FormData(form);
        $.ajax({
            type: "POST",
            enctype: 'multipart/form-data',
            url: "/panel/save",
            data: data,
            processData: false, //prevent jQuery from automatically transforming the data into a query string
            contentType: false,
            cache: false,
            success: function (data) {
                alert(data.resultDescription);
            },
            error: function (e) {
                alert("异常");
            }
        });
    }

    function closeAPanelHistory(){
        var out1 = $('.out1');
        out1.fadeOut(500);

        $('#panel-form').find('[name]').each(function() {
            var type = $(this)[0].nodeName.toLowerCase();
            var name = $(this).attr('name');
            if (name!="gallery"&&name!="uploadedbytran") {
                $(type+"[name='"+name+"']").val(null);
            }
        });
    }

    function updatePanel(panelId){
        var form = $('#panelform-'+panelId)[0];
        var data = new FormData(form);
        $.ajax({
            type: "POST",
            enctype: 'multipart/form-data',
            url: "/panel/update",
            data: data,
            processData: false, //prevent jQuery from automatically transforming the data into a query string
            contentType: false,
            cache: false,
            success: function (data) {
                alert(data.resultDescription);
            },
            error: function (e) {
                alert("异常");
            }
        });
    }

    function closePanelHistory() {
        var out4 = $('.out4');
        out4.fadeOut(500);

        $("#panelHistoryList").html("");
    }






    function openChangePwd(){
        var out2 =$('.out2');
        out2.fadeIn(500);
    }

    function closeChangePwd(){
        var out2 =$('.out2');
        out2.fadeOut(500);
    }

    function openUserList(){
        getuserlist();
        var out3 =$('.out3');
        out3.fadeIn(500);
    }
    function closeUserList(){
        var out3 =$('.out3');
        out3.fadeOut(500);
    }

    function activeUser(username,active){
        var temp = username.toString();
        $.ajax({
            //几个参数需要注意一下
            type: "post",//方法类型
            dataType: "json",//预期服务器返回的数据类型
            url: "/user/activeUser" ,//url
            data: {"username":temp,"active":active},
            success: function (data) {
                alert(data.resultDescription);
                getuserlist();
            },
            error : function() {
                alert("异常！");
            }
        });
    }

</script>

</body>

<!-- END BODY -->

</html>